{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "microstructure": {
    "type": "object",
    "description": "One snapshot of the evolving microstructure (grain-averaged and voxel-resolved state).",
    "properties": {
      "time": {
        "type": "number",
        "description": "Time coordinate of this snapshot. If physical time, specify time_unit; otherwise interpreted as a step index.",
        "property": "Time"
      },
	  "grid": {
		"type": "object",
		"description": "Grid definition for this microstructure snapshot, including its deformation state, physical size, and voxel-aligned spacing.",
		"properties": {
			"status":{
				"type": "string",
				"description": "Condition of the grid for this snapshot. 'regular' indicates an undeformed, orthogonal grid (typically at the initial state). 'distorted' indicates a deformed/non-orthogonal grid resulting from microstructure evolution during simulation.",
				"enum": ["regular", "distorted"],
				"default": "regular"
			},
			"grid_size": {
				"type": "array",
				"items": {
					"type": "number"
				  },
				  "minItems": 3,
				  "maxItems": 3,
				  "description": "Tuple of three numbers [lx, ly, lz] representing the physical dimensions of the grid.",
				  "property": "Length"
            },
			"grid_spacing": {
				"description": "Spacing between grid points (aligned with voxels). Either a uniform scalar spacing or a 3-element vector [dx, dy, dz].",
				"oneOf": [
					{
					"type": "number",
					"description": "Uniform grid spacing.",
					"property": "Length"
					},
					{
					"type": "array",
					"items": {
						"type": "number"
					},
					"minItems": 3,
					"maxItems": 3,
					"description": "Tuple of three numbers [dx, dy, dz] representing the physical spacing of the grid in three directions.",
					"property": "Length"
					}
				]
			}
		},
		"required": ["status", "grid_size", "grid_spacing"],
		"additionalProperties": false
	  },
      "grains": {
        "type": "array",
        "description": "Grain-averaged state at current time.",
        "items": {
          "type": "object",
          "description": "Grain-level state variables (averaged over the grain).",
          "properties": {
            "grain_id": {
              "type": "integer",
              "minimum": 0,
              "description": "Unique grain identifier, stable across time steps."
            },
            "phase_id": {
              "type": "integer",
              "minimum": 0,
              "description": "Phase identifier this grain belongs to; must match a phase defined elsewhere."
            },
            "orientation": {
              "type": "array",
              "items": { "type": "number" },
              "minItems": 3,
              "maxItems": 3,
              "description": "Average grain orientation over all voxels belonging to this grain. Three Euler angles (Phi1, Phi2, Phi3) in radians following the ZXZ/Bunge convention. Example: [0.37483353062749086, 0.8106405166004831, 1.072460818721277] where entries correspond to Phi1, Phi2, Phi3 respectively.",
              "property": "Angle"
            },
            "grain_volume": {
              "type": "number",
              "minimum": 0,
              "description": "Grain volume.",
              "property": "Volume"
            }
          },
          "required": ["grain_id", "phase_id", "orientation"]
        }
      },
      "voxels": {
        "type": "array",
        "description": "Per-voxel state at current time.",
        "items": {
          "type": "object",
          "description": "Voxel-level state variables.",
          "properties": {
            "voxel_id": {
              "type": "integer",
              "minimum": 0,
              "description": "Unique voxel identifier (stable index in the discretization)."
            },
            "grain_id": {
              "type": "integer",
              "minimum": 0,
              "description": "Owning grain identifier establishing voxelâ†’grain membership."
            },
            "orientation": {
              "type": "array",
              "items": { "type": "number" },
              "minItems": 3,
              "maxItems": 3,
              "description": "Local orientation of this voxel. Three Euler angles (Phi1, Phi, Phi2) in radians following the ZXZ/Bunge convention. Example: [0.37483353062749086, 0.8106405166004831, 1.072460818721277] where entries correspond to Phi1, Phi, Phi2 respectively.",
              "property": "Angle"
            },
            "voxel_index": {
              "type": "array",
              "description": "Integral voxel index (i, j, k), 1-based.",
              "items": { "type": "integer", "minimum": 1 },
              "minItems": 3,
              "maxItems": 3,
              "property": "Index"
            },
            "centroid_coordinates": {
              "type": "array",
              "description": "Voxel centroid (x, y, z) in length units.",
              "items": { "type": "number" },
              "minItems": 3,
              "maxItems": 3,
              "property": "Length"
            },
            "voxel_volume": {
              "type": "number",
              "minimum": 0,
              "description": "Voxel volume.",
              "property": "Volume"
            }
          },
          "required": ["voxel_id", "grain_id", "orientation"],
          "oneOf": [
            { "required": ["voxel_index"] },
            { "required": ["centroid_coordinates"] }
          ]
        }
      }
    },
    "required": ["time", "grid", "grains", "voxels"]
}
}
