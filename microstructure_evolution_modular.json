{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "microstructure_evolution": {
    "type": "object",
    "description": "One snapshot of the evolving microstructure (grain-averaged and voxel-resolved state).",
    "properties": {
      "time": {
        "type": "number",
        "description": "Time coordinate of this snapshot. If physical time, specify time_unit; otherwise interpreted as a step index.",
        "property": "Time"
      },
      "grains": {
        "type": "array",
        "description": "Grain-averaged state at current time.",
        "items": {
          "type": "object",
          "description": "Grain-level state variables (averaged over the grain).",
          "properties": {
            "grain_id": {
              "type": "integer",
              "minimum": 0,
              "description": "Unique grain identifier, stable across time steps."
            },
            "phase_id": {
              "type": "integer",
              "minimum": 0,
              "description": "Phase identifier this grain belongs to; must match a phase defined elsewhere."
            },
            "orientation": {
              "type": "array",
              "items": { "type": "number" },
              "minItems": 3,
              "maxItems": 3,
              "description": "Average grain orientation over all voxels belonging to this grain. Three Euler angles (Phi1, Phi2, Phi3) in radians following the ZXZ/Bunge convention. Example: [0.37483353062749086, 0.8106405166004831, 1.072460818721277] where entries correspond to Phi1, Phi2, Phi3 respectively.",
              "property": "Angle"
            },
            "grain_volume": {
              "type": "number",
              "minimum": 0,
              "description": "Grain volume.",
              "property": "Volume"
            }
          },
          "required": ["grain_id", "phase_id", "orientation"]
        }
      },
      "voxels": {
        "type": "array",
        "description": "Per-voxel state at current time.",
        "items": {
          "type": "object",
          "description": "Voxel-level state variables.",
          "properties": {
            "voxel_id": {
              "type": "integer",
              "minimum": 0,
              "description": "Unique voxel identifier (stable index in the discretization)."
            },
            "grain_id": {
              "type": "integer",
              "minimum": 0,
              "description": "Owning grain identifier establishing voxelâ†’grain membership."
            },
            "orientation": {
              "type": "array",
              "items": { "type": "number" },
              "minItems": 3,
              "maxItems": 3,
              "description": "Local orientation of this voxel. Three Euler angles (Phi1, Phi, Phi2) in radians following the ZXZ/Bunge convention. Example: [0.37483353062749086, 0.8106405166004831, 1.072460818721277] where entries correspond to Phi1, Phi, Phi2 respectively.",
              "property": "Angle"
            },
            "voxel_index": {
              "type": "array",
              "description": "Integral voxel index (i, j, k), 1-based.",
              "items": { "type": "integer", "minimum": 1 },
              "minItems": 3,
              "maxItems": 3,
              "property": "Index"
            },
            "centroid_coordinates": {
              "type": "array",
              "description": "Voxel centroid (x, y, z) in length units.",
              "items": { "type": "number" },
              "minItems": 3,
              "maxItems": 3,
              "property": "Length"
            },
            "voxel_volume": {
              "type": "number",
              "minimum": 0,
              "description": "Voxel volume.",
              "property": "Volume"
            }
          },
          "required": ["voxel_id", "grain_id", "orientation"],
          "oneOf": [
            { "required": ["voxel_index"] },
            { "required": ["centroid_coordinates"] }
          ]
        }
      }
    },
    "required": ["time", "grains", "voxels"]
  },
  "Time": {
    "type": "string",
    "default": "second",
    "description": "Unit of time if 'time' is physical time or as a step index.",
    "enum": ["s", "min", "step"]
  }
}
